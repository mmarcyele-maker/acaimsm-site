<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A√ßa√≠ MSM</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:10px;
}

h2{margin-top:0}

.card{
  background:#fff;
  padding:12px;
  border-radius:10px;
  margin-bottom:12px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}

.linha{
  display:flex;
  align-items:center;
  gap:6px;
  margin:5px 0;
}

button{
  padding:4px 8px;
  border:none;
  border-radius:4px;
  background:#7b2cbf;
  color:#fff;
}

button.sec{
  background:#999;
}

.qtd{
  min-width:20px;
  text-align:center;
}

#adicional{
  margin-left:10px;
}

#carrinhoIcon{
  position:fixed;
  bottom:15px;
  right:15px;
  background:#7b2cbf;
  color:#fff;
  padding:14px;
  border-radius:50%;
  font-size:18px;
  z-index:1000;
}

#contador{
  font-size:14px;
}

#carrinhoBox{
  position:fixed;
  top:0;
  right:-100%;
  width:100%;
  max-width:400px;
  height:100%;
  background:#fff;
  z-index:999;
  transition:.4s ease;
  overflow-y:auto;
  padding:10px;
  box-shadow:-5px 0 15px rgba(0,0,0,.3);
}

#carrinhoBox.ativo{
  right:0;
}

.item{
  border-bottom:1px solid #ddd;
  padding:6px 0;
}

.total{
  font-size:18px;
  font-weight:bold;
  margin:10px 0;
}
</style>
</head>

<body>

<h2>üçß A√ßa√≠ MSM</h2>

<div class="card">
  <b>A√ßa√≠ 500ml ‚Äî R$18,00</b>

  <div class="linha">
    <button onclick="alt(this,-1)">‚ûñ</button>
    <span class="qtd">1</span>
    <button onclick="alt(this,1)">‚ûï</button>
  </div>

  <div id="adicional">
    <div class="linha" data-nome="Leite em p√≥" data-preco="2">
      Leite em p√≥ R$2
      <button onclick="alt(this,-1)">‚ûñ</button>
      <span class="qtd">0</span>
      <button onclick="alt(this,1)">‚ûï</button>
    </div>

    <div class="linha" data-nome="Leite condensado" data-preco="2">
      Leite condensado R$2
      <button onclick="alt(this,-1)">‚ûñ</button>
      <span class="qtd">0</span>
      <button onclick="alt(this,1)">‚ûï</button>
    </div>
  </div>

  <button onclick="add()">Adicionar</button>
</div>

<!-- CARRINHO -->
<div id="carrinhoBox">
<h3>Carrinho</h3>

<input id="nome" placeholder="Seu nome"><br><br>

<select id="entrega" onchange="calcEntrega()">
  <option value="">Entrega ou retirada</option>
  <option value="retirada">Retirada gr√°tis</option>
  <option value="entrega">Entrega Jardim Jacira (+R$4)</option>
</select><br><br>

<input id="endereco" placeholder="Endere√ßo (se entrega)"><br><br>

<select id="pagamento" onchange="trocaPagamento()">
  <option value="">Forma de pagamento</option>
  <option>Pix</option>
  <option>Dinheiro</option>
</select>

<div id="pix" style="display:none">
  <p><b>Pix:</b> 11984550595<br>
  <b>Nome:</b> Marcyele da Silva Maciel</p>
</div>

<div id="trocoBox" style="display:none">
  <input id="valorPago" type="number" placeholder="Vai pagar com quanto?" oninput="calcTroco()">
  <label>
    <input type="checkbox" id="semTroco" onchange="calcTroco()"> N√£o precisa de troco
  </label>
  <div id="infoTroco"></div>
</div>

<div id="lista"></div>
<div class="total" id="total">Total: R$ 0,00</div>

<button onclick="finalizar()">Finalizar no WhatsApp</button>
<button class="sec" onclick="fechar()">Fechar</button>
</div>

<div id="carrinhoIcon" onclick="abrir()">üõí <span id="contador">0</span></div>

<script>
let carrinho=[], total=0, taxa=0;

function alt(btn,v){
  let s=btn.parentElement.querySelector(".qtd");
  s.innerText=Math.max(0, +s.innerText+v);
}

function add(){
  let card=document.querySelector(".card");
  let qtd=+card.querySelector(".qtd").innerText;
  if(!qtd)return;

  let sub=18*qtd;
  let ads=[];

  card.querySelectorAll("#adicional .linha").forEach(a=>{
    let q=+a.querySelector(".qtd").innerText;
    if(q){
      let p=+a.dataset.preco;
      sub+=q*p;
      ads.push({nome:a.dataset.nome,valor:q*p});
      a.querySelector(".qtd").innerText=0;
    }
  });

  carrinho.push({qtd,ads,sub});
  total+=sub;
  salvar();
  atualizar();
}

function atualizar(){
  lista.innerHTML="";
  let itens=0;

  carrinho.forEach((i,idx)=>{
    itens+=i.qtd;
    lista.innerHTML+=`
      <div class="item">
        A√ßa√≠ 500ml x${i.qtd}
        <button onclick="rm(${idx})">‚ùå</button><br>
        ${i.ads.map((a,j)=>`‚ûï ${a.nome} R$${a.valor.toFixed(2)}
        <button onclick="rmAd(${idx},${j})">‚ùå</button>`).join("<br>")}
        <div>Subtotal: R$ ${i.sub.toFixed(2)}</div>
      </div>`;
  });

  contador.innerText=itens;
  totalDiv();
}

function totalDiv(){
  totalSpan=total+taxa;
  total.innerText="Total: R$ "+totalSpan.toFixed(2);
}

function rm(i){
  if(!confirm("Remover item?"))return;
  total-=carrinho[i].sub;
  carrinho.splice(i,1);
  salvar();
  atualizar();
}

function rmAd(i,a){
  if(!confirm("Remover adicional?"))return;
  total-=carrinho[i].ads[a].valor;
  carrinho[i].sub-=carrinho[i].ads[a].valor;
  carrinho[i].ads.splice(a,1);
  salvar();
  atualizar();
}

function abrir(){carrinhoBox.classList.add("ativo")}
function fechar(){carrinhoBox.classList.remove("ativo")}

function calcEntrega(){
  taxa=entrega.value==="entrega"?4:0;
  totalDiv();
}

function trocaPagamento(){
  pix.style.display=pagamento.value==="Pix"?"block":"none";
  trocoBox.style.display=pagamento.value==="Dinheiro"?"block":"none";
}

function calcTroco(){
  if(semTroco.checked){
    infoTroco.innerText="N√£o precisa de troco";
    return;
  }
  let p=+valorPago.value;
  let t=total+taxa;
  infoTroco.innerText=p>=t?"Troco: R$ "+(p-t).toFixed(2):"Valor insuficiente";
}

function finalizar(){
  if(!nome.value||!entrega.value||!pagamento.value)return alert("Preencha os dados");

  let msg=`üçß Pedido A√ßa√≠ MSM\nCliente: ${nome.value}\n`;
  msg+=entrega.value==="retirada"?"Retirada\n":"Entrega (+R$4)\n";
  carrinho.forEach(i=>msg+=`‚Ä¢ A√ßa√≠ 500ml x${i.qtd} R$${i.sub.toFixed(2)}\n`);
  msg+=`Total: R$ ${(total+taxa).toFixed(2)}`;
  window.open("https://wa.me/5511943818352?text="+encodeURIComponent(msg));
  localStorage.removeItem("carrinho");
}

function salvar(){
  localStorage.setItem("carrinho",JSON.stringify({carrinho,total}));
}

window.onload=()=>{
  let s=JSON.parse(localStorage.getItem("carrinho"));
  if(s){carrinho=s.carrinho;total=s.total;atualizar();}
};
</script>

</body>
</html>
