<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>A√ßa√≠ MSM</title>

<style>
body{font-family:Arial;margin:0;background:#f4f4f4}
.card{background:#fff;margin:10px;padding:10px;border-radius:8px}
.qtd{margin:0 5px}
button{cursor:pointer}

#carrinhoIcon{
  position:fixed;bottom:15px;right:15px;
  background:#800080;color:#fff;
  padding:10px;border-radius:50%;
  font-size:18px;z-index:1000
}

#carrinhoBox{
  position:fixed;top:0;right:-100%;
  width:90%;max-width:400px;height:100%;
  background:#fff;z-index:999;
  transition:.4s ease;overflow-y:auto;
  box-shadow:-5px 0 15px rgba(0,0,0,.3);
  padding:10px
}
#carrinhoBox.ativo{right:0}

.item-carrinho{border-bottom:1px solid #ddd;padding:8px 0}

.total{font-size:18px;font-weight:bold;margin:10px 0}

#adminBox{
  display:none;position:fixed;top:0;left:0;
  width:100%;height:100%;background:#fff;
  z-index:2000;padding:10px;overflow:auto
}
#adminBox.ativo{display:block}
</style>
</head>

<body>

<!-- PRODUTO EXEMPLO -->
<div class="card" data-nome="A√ßa√≠ 500ml" data-preco="18" data-img="img/acai500.png">
  <h3>A√ßa√≠ 500ml</h3>
  <button onclick="alterarQtd(this,-1)">‚ûñ</button>
  <span class="qtd">1</span>
  <button onclick="alterarQtd(this,1)">‚ûï</button>

  <div class="adicional" data-nome="Leite em p√≥" data-preco="2">
    Leite em p√≥ R$2
    <button onclick="alterarQtd(this,-1)">‚ûñ</button>
    <span class="qtd">0</span>
    <button onclick="alterarQtd(this,1)">‚ûï</button>
  </div>

  <div class="adicional" data-nome="Leite condensado" data-preco="2">
    Leite condensado R$2
    <button onclick="alterarQtd(this,-1)">‚ûñ</button>
    <span class="qtd">0</span>
    <button onclick="alterarQtd(this,1)">‚ûï</button>
  </div>

  <br>
  <button onclick="adicionarCarrinho(this)">Adicionar</button>
</div>

<!-- CARRINHO -->
<div id="carrinhoBox">
<h3>Carrinho</h3>

<input id="nomeCliente" placeholder="Seu nome"><br><br>

<select id="tipoEntrega">
  <option value="">Entrega ou retirada</option>
  <option value="retirada">Retirada gr√°tis</option>
  <option value="jacira">Entrega Jardim Jacira (+R$4)</option>
</select><br><br>

<input id="enderecoCliente" placeholder="Endere√ßo (se entrega)"><br><br>

<select id="pagamento">
  <option value="">Forma de pagamento</option>
  <option>Pix</option>
  <option>Dinheiro</option>
</select>

<div id="pixInfo" style="display:none">
  <b>Pix:</b> 11984550595<br>
  <b>Nome:</b> Marcyele da Silva Maciel<br>
  <label><input type="checkbox" id="confirmouPix"> Confirmei pagamento Pix</label>
</div>

<div id="trocoBox" style="display:none">
  <input id="valorPago" type="number" placeholder="Vai pagar com quanto?" oninput="calcularTroco()">
  <label>
    <input type="checkbox" id="semTroco" onchange="calcularTroco()"> N√£o precisa de troco
  </label>
  <div id="trocoInfo"></div>
</div>

<textarea id="obs" placeholder="Observa√ß√µes"></textarea>

<div id="lista"></div>
<div class="total" id="totalDiv">Total: R$ 0,00</div>

<button onclick="finalizar()">Finalizar no WhatsApp</button><br><br>
<button onclick="fecharCarrinho()">Fechar</button>
</div>

<button id="adminBtn" onclick="abrirAdmin()">Admin</button>

<div id="adminBox">
<h2>Painel Admin</h2>
<div id="adminPedidos"></div>
<div class="total" id="totalFaturado"></div>
<button onclick="limparPedidos()">Limpar pedidos</button>
<button onclick="fecharAdmin()">Fechar</button>
</div>

<div id="carrinhoIcon" onclick="abrirCarrinho()">üõí <span id="contador">0</span></div>

<script>
let carrinho=[], total=0, taxaEntrega=0, pedidosSalvos=[];

function alterarQtd(btn,v){
  let s=btn.parentElement.querySelector(".qtd");
  s.innerText=Math.max(0,parseInt(s.innerText)+v);
}

function adicionarCarrinho(btn){
  let card=btn.closest(".card");
  let nome=card.dataset.nome;
  let preco=+card.dataset.preco;
  let img=card.dataset.img;
  let qtd=+card.querySelector(".card .qtd").innerText;
  if(!qtd) return;

  let adicionais=[], sub=qtd*preco;

  card.querySelectorAll(".adicional").forEach(a=>{
    let q=+a.querySelector(".qtd").innerText;
    let p=+a.dataset.preco;
    if(q){
      sub+=q*p;
      adicionais.push(`${a.dataset.nome} R$${p.toFixed(2)} x${q}`);
      a.querySelector(".qtd").innerText=0;
    }
  });

  carrinho.push({nome,qtd,img,adicionais,sub});
  total+=sub;
  atualizarCarrinho();
}

function atualizarCarrinho(){
  let lista=document.getElementById("lista");
  lista.innerHTML="";
  let itens=0;

  carrinho.forEach((i,index)=>{
    itens+=i.qtd;

    let ads="";
    i.adicionais.forEach((a,ai)=>{
      let v=parseFloat(a.match(/R\\$([0-9.]+)/)[1]);
      ads+=`
        <div>
          ‚ûï ${a}
          <button onclick="removerAdicional(${index},${ai},${v})">‚ùå</button>
        </div>`;
    });

    lista.innerHTML+=`
      <div class="item-carrinho">
        <img src="${i.img}" width="40" style="float:left;margin-right:8px;border-radius:6px">
        <b>${i.nome}</b>
        <div style="float:right">
          <button onclick="alterarQtdCarrinho(${index},-1)">‚ûñ</button>
          ${i.qtd}
          <button onclick="alterarQtdCarrinho(${index},1)">‚ûï</button>
          <button onclick="removerItem(${index})">‚ùå</button>
        </div>
        <br>${ads}
        <div>Subtotal: R$ ${i.sub.toFixed(2)}</div>
      </div>`;
  });

  contador.innerText=itens;
  totalDiv.innerText="Total: R$ "+(total+taxaEntrega).toFixed(2);
  localStorage.setItem("carrinhoSalvo",JSON.stringify({carrinho,total}));
}

function alterarQtdCarrinho(i,v){
  let item=carrinho[i];
  let unit=item.sub/item.qtd;
  if(item.qtd+v<=0) return removerItem(i);
  item.qtd+=v;
  item.sub=unit*item.qtd;
  total=carrinho.reduce((s,i)=>s+i.sub,0);
  atualizarCarrinho();
}

function removerItem(i){
  if(!confirm("Remover item?"))return;
  total-=carrinho[i].sub;
  carrinho.splice(i,1);
  atualizarCarrinho();
}

function removerAdicional(i,a,v){
  if(!confirm("Remover adicional?"))return;
  carrinho[i].sub-=v;
  total-=v;
  carrinho[i].adicionais.splice(a,1);
  atualizarCarrinho();
}

function abrirCarrinho(){atualizarCarrinho();carrinhoBox.classList.add("ativo")}
function fecharCarrinho(){carrinhoBox.classList.remove("ativo")}

tipoEntrega.onchange=e=>{taxaEntrega=e.target.value==="jacira"?4:0;atualizarCarrinho()}

pagamento.onchange=()=>{
  pixInfo.style.display=pagamento.value==="Pix"?"block":"none";
  trocoBox.style.display=pagamento.value==="Dinheiro"?"block":"none";
}

function calcularTroco(){
  if(semTroco.checked){
    trocoInfo.innerText="N√£o precisa de troco";
    return;
  }
  let p=+valorPago.value;
  let t=total+taxaEntrega;
  if(p<t) trocoInfo.innerText="Valor insuficiente";
  else trocoInfo.innerText="Troco: R$ "+(p-t).toFixed(2);
}

function finalizar(){
  if(!nomeCliente.value||!tipoEntrega.value||!pagamento.value)return alert("Preencha os dados");

  let msg=`üçß Pedido A√ßa√≠ MSM\nCliente: ${nomeCliente.value}\n`;
  msg+=tipoEntrega.value==="retirada"?"Retirada\n":"Entrega (+R$4)\n";
  carrinho.forEach(i=>msg+=`‚Ä¢ ${i.nome} x${i.qtd} R$${i.sub.toFixed(2)}\n`);
  if(pagamento.value==="Dinheiro"){
    if(semTroco.checked) msg+="üíµ Dinheiro ‚Äî sem troco\n";
    else msg+=`üíµ Pagar√° com R$${valorPago.value}\n`;
  }
  msg+=`Total: R$ ${(total+taxaEntrega).toFixed(2)}`;

  localStorage.removeItem("carrinhoSalvo");
  window.open("https://wa.me/5511943818352?text="+encodeURIComponent(msg));
}

window.onload=()=>{
  let s=JSON.parse(localStorage.getItem("carrinhoSalvo"));
  if(s){carrinho=s.carrinho;total=s.total;atualizarCarrinho();}
}

// ADMIN
const senhaAdmin="msm2026";
function abrirAdmin(){
  let s=prompt("Senha:");
  if(s!==senhaAdmin)return;
  pedidosSalvos=JSON.parse(localStorage.getItem("pedidosSalvos"))||[];
  let h="",t=0;
  pedidosSalvos.forEach(p=>{h+=`<div>${p.nome} R$${p.total}</div>`;t+=p.total});
  adminPedidos.innerHTML=h;
  totalFaturado.innerText="Total: R$ "+t;
  adminBox.classList.add("ativo");
}
function fecharAdmin(){adminBox.classList.remove("ativo")}
function limparPedidos(){localStorage.clear();location.reload()}
</script>

</body>
</html>
